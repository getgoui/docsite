{"version":3,"names":["goDropdownMenuCss","GoDropdownMenu","this","focusedMenuItemIndex","focusLastOnNextOpen","open","dropdownEl","isActive","close","focusBackToTrigger","componentWillLoad","triggerEl","document","querySelector","triggerSelector","menuId","uniqueId","setTriggerRoles","addTriggerEventListeners","componentDidLoad","addMenuItemEventListeners","setAttribute","addEventListener","e","key","menuItemEls","Array","from","menuEl","querySelectorAll","length","forEach","item","preventDefault","focusMenuItem","dropdownItem","i","focusInControl","focusOutControl","handleDropdownOpened","handleDropdownClosed","handleItemSelected","persistent","render","width","dropdownProps","h","Object","assign","ref","el","noTriggerClickHandler","onOpened","onClosed","role","class","id"],"sources":["src/components/go-dropdown-menu/go-dropdown-menu.scss?tag=go-dropdown-menu","src/components/go-dropdown-menu/go-dropdown-menu.tsx"],"sourcesContent":["go-dropdown-menu {\r\n  /**\r\n    @prop --dd-item-gap:\r\n      Gap between dropdown items\r\n      - default: 0\r\n  */\r\n  --dd-item-gap: 0;\r\n  .dropdown-menu-inner {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: var(--dd-item-gap);\r\n  }\r\n}\r\n","import { Component, h, Element, Prop, Method, Listen } from '@stencil/core';\r\nimport { DropdownProps } from '../../interfaces';\r\nimport { uniqueId } from 'lodash-es';\r\n\r\n@Component({\r\n  tag: 'go-dropdown-menu',\r\n  styleUrl: 'go-dropdown-menu.scss',\r\n  shadow: false,\r\n})\r\nexport class GoDropdownMenu implements DropdownProps {\r\n  @Element() el: HTMLElement;\r\n\r\n  /**\r\n   * @see [go-dropdown](go-dropdown#props)\r\n   */\r\n  @Prop() triggerSelector: string;\r\n  /**\r\n   * keep track of active state\r\n   */\r\n  @Prop({ reflect: true, mutable: true }) isActive: boolean = false;\r\n\r\n  /**\r\n   * customise width of dropdown menu\r\n   */\r\n  @Prop() width?: string;\r\n\r\n  /**\r\n   * DOM id for menu\r\n   */\r\n  @Prop({ mutable: true })\r\n  menuId?: string;\r\n\r\n  /**\r\n   * If persistent, the dropdown will not close by itself on interaction with elements inside the menu.\r\n   */\r\n  @Prop() persistent? = false;\r\n\r\n  triggerEl: HTMLElement;\r\n  dropdownEl: HTMLGoDropdownElement;\r\n  menuEl: HTMLElement;\r\n  menuItemEls?: HTMLElement[];\r\n  focusedMenuItemIndex = 0;\r\n  focusLastOnNextOpen = false;\r\n  /**\r\n   * open menu\r\n   * @param focusFirst if auto focus on first item\r\n   */\r\n  @Method()\r\n  async open() {\r\n    if (!this.dropdownEl.isActive) {\r\n      // open menu and focus on first item\r\n      this.dropdownEl.open();\r\n    }\r\n  }\r\n\r\n  @Method()\r\n  async close(focusBackToTrigger = false) {\r\n    this.dropdownEl.close(focusBackToTrigger);\r\n  }\r\n\r\n  componentWillLoad() {\r\n    this.triggerEl = document.querySelector(this.triggerSelector);\r\n    if (!this.menuId) {\r\n      this.menuId = uniqueId('go-dropdown-menu-');\r\n    }\r\n\r\n    this.setTriggerRoles();\r\n    this.addTriggerEventListeners();\r\n  }\r\n\r\n  componentDidLoad() {\r\n    this.addMenuItemEventListeners();\r\n  }\r\n\r\n  setTriggerRoles() {\r\n    this.triggerEl.setAttribute('aria-controls', this.menuId);\r\n  }\r\n  addTriggerEventListeners() {\r\n    this.triggerEl.addEventListener('click', () => {\r\n      if (this.isActive) {\r\n        this.close();\r\n      } else {\r\n        this.open();\r\n      }\r\n    });\r\n    this.triggerEl.addEventListener('keydown', (e) => {\r\n      if (!this.dropdownEl) {\r\n        return;\r\n      }\r\n      const key = e.key;\r\n      if (key === 'ArrowUp') {\r\n        this.focusLastOnNextOpen = true;\r\n        this.open();\r\n      }\r\n      if (key === 'ArrowDown') {\r\n        this.open();\r\n      }\r\n    });\r\n  }\r\n\r\n  addMenuItemEventListeners() {\r\n    if (!this.menuItemEls) {\r\n      this.menuItemEls = Array.from(this.menuEl.querySelectorAll('go-dropdown-item'));\r\n    }\r\n    if (!this.menuItemEls.length) {\r\n      // no `go-dropdown-item` found\r\n      return;\r\n    }\r\n\r\n    // up down arrow keys move focus between menu items\r\n    this.menuItemEls.forEach((item) => {\r\n      item.addEventListener('keydown', (e) => {\r\n        if (e.key === 'Tab') {\r\n          this.close();\r\n        }\r\n        if (e.key === 'ArrowDown') {\r\n          e.preventDefault();\r\n          this.focusedMenuItemIndex += 1;\r\n          if (this.focusedMenuItemIndex > this.menuItemEls.length - 1) {\r\n            this.focusedMenuItemIndex = 0;\r\n          }\r\n          this.focusMenuItem();\r\n        }\r\n\r\n        if (e.key === 'ArrowUp') {\r\n          e.preventDefault();\r\n          this.focusedMenuItemIndex -= 1;\r\n          if (this.focusedMenuItemIndex < 0) {\r\n            this.focusedMenuItemIndex = this.menuItemEls.length - 1;\r\n          }\r\n          this.focusMenuItem();\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  focusMenuItem() {\r\n    this.menuItemEls.forEach((dropdownItem: HTMLGoDropdownItemElement, i) => {\r\n      if (i === this.focusedMenuItemIndex) {\r\n        dropdownItem.focusInControl();\r\n      } else {\r\n        dropdownItem.focusOutControl();\r\n      }\r\n    });\r\n  }\r\n  handleDropdownOpened() {\r\n    this.isActive = true;\r\n    if (this.focusLastOnNextOpen) {\r\n      this.focusedMenuItemIndex = this.menuItemEls.length - 1;\r\n      this.focusLastOnNextOpen = false;\r\n    } else {\r\n      this.focusedMenuItemIndex = 0;\r\n    }\r\n\r\n    this.focusMenuItem();\r\n  }\r\n\r\n  handleDropdownClosed() {\r\n    this.isActive = false;\r\n  }\r\n\r\n  @Listen('selected')\r\n  handleItemSelected() {\r\n    if (!this.persistent) {\r\n      this.close();\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const { triggerSelector, isActive, width, menuId } = this;\r\n    const dropdownProps = {\r\n      triggerSelector,\r\n      isActive,\r\n      width,\r\n    };\r\n    return (\r\n      <go-dropdown\r\n        ref={(el) => {\r\n          this.dropdownEl = el;\r\n        }}\r\n        noTriggerClickHandler={true}\r\n        onOpened={() => this.handleDropdownOpened()}\r\n        onClosed={() => this.handleDropdownClosed()}\r\n        {...dropdownProps}>\r\n        <div\r\n          role=\"menu\"\r\n          class=\"dropdown-menu-inner\"\r\n          id={menuId}\r\n          ref={(el) => {\r\n            this.menuEl = el;\r\n          }}>\r\n          <slot></slot>\r\n        </div>\r\n      </go-dropdown>\r\n    );\r\n  }\r\n}\r\n"],"mappings":"sFAAA,MAAMA,EAAoB,oI,MCSbC,EAAc,M,yBAgCzBC,KAAAC,qBAAuB,EACvBD,KAAAE,oBAAsB,M,6CAvBsC,M,2DAgBtC,K,CAatB,UAAMC,GACJ,IAAKH,KAAKI,WAAWC,SAAU,CAE7BL,KAAKI,WAAWD,M,EAKpB,WAAMG,CAAMC,EAAqB,OAC/BP,KAAKI,WAAWE,MAAMC,E,CAGxB,iBAAAC,GACER,KAAKS,UAAYC,SAASC,cAAcX,KAAKY,iBAC7C,IAAKZ,KAAKa,OAAQ,CAChBb,KAAKa,OAASC,EAAS,oB,CAGzBd,KAAKe,kBACLf,KAAKgB,0B,CAGP,gBAAAC,GACEjB,KAAKkB,2B,CAGP,eAAAH,GACEf,KAAKS,UAAUU,aAAa,gBAAiBnB,KAAKa,O,CAEpD,wBAAAG,GACEhB,KAAKS,UAAUW,iBAAiB,SAAS,KACvC,GAAIpB,KAAKK,SAAU,CACjBL,KAAKM,O,KACA,CACLN,KAAKG,M,KAGTH,KAAKS,UAAUW,iBAAiB,WAAYC,IAC1C,IAAKrB,KAAKI,WAAY,CACpB,M,CAEF,MAAMkB,EAAMD,EAAEC,IACd,GAAIA,IAAQ,UAAW,CACrBtB,KAAKE,oBAAsB,KAC3BF,KAAKG,M,CAEP,GAAImB,IAAQ,YAAa,CACvBtB,KAAKG,M,KAKX,yBAAAe,GACE,IAAKlB,KAAKuB,YAAa,CACrBvB,KAAKuB,YAAcC,MAAMC,KAAKzB,KAAK0B,OAAOC,iBAAiB,oB,CAE7D,IAAK3B,KAAKuB,YAAYK,OAAQ,CAE5B,M,CAIF5B,KAAKuB,YAAYM,SAASC,IACxBA,EAAKV,iBAAiB,WAAYC,IAChC,GAAIA,EAAEC,MAAQ,MAAO,CACnBtB,KAAKM,O,CAEP,GAAIe,EAAEC,MAAQ,YAAa,CACzBD,EAAEU,iBACF/B,KAAKC,sBAAwB,EAC7B,GAAID,KAAKC,qBAAuBD,KAAKuB,YAAYK,OAAS,EAAG,CAC3D5B,KAAKC,qBAAuB,C,CAE9BD,KAAKgC,e,CAGP,GAAIX,EAAEC,MAAQ,UAAW,CACvBD,EAAEU,iBACF/B,KAAKC,sBAAwB,EAC7B,GAAID,KAAKC,qBAAuB,EAAG,CACjCD,KAAKC,qBAAuBD,KAAKuB,YAAYK,OAAS,C,CAExD5B,KAAKgC,e,IAEP,G,CAIN,aAAAA,GACEhC,KAAKuB,YAAYM,SAAQ,CAACI,EAAyCC,KACjE,GAAIA,IAAMlC,KAAKC,qBAAsB,CACnCgC,EAAaE,gB,KACR,CACLF,EAAaG,iB,KAInB,oBAAAC,GACErC,KAAKK,SAAW,KAChB,GAAIL,KAAKE,oBAAqB,CAC5BF,KAAKC,qBAAuBD,KAAKuB,YAAYK,OAAS,EACtD5B,KAAKE,oBAAsB,K,KACtB,CACLF,KAAKC,qBAAuB,C,CAG9BD,KAAKgC,e,CAGP,oBAAAM,GACEtC,KAAKK,SAAW,K,CAIlB,kBAAAkC,GACE,IAAKvC,KAAKwC,WAAY,CACpBxC,KAAKM,O,EAIT,MAAAmC,GACE,MAAM7B,gBAAEA,EAAeP,SAAEA,EAAQqC,MAAEA,EAAK7B,OAAEA,GAAWb,KACrD,MAAM2C,EAAgB,CACpB/B,kBACAP,WACAqC,SAEF,OACEE,EAAA,cAAAC,OAAAC,OAAA,CACEC,IAAMC,IACJhD,KAAKI,WAAa4C,CAAE,EAEtBC,sBAAuB,KACvBC,SAAU,IAAMlD,KAAKqC,uBACrBc,SAAU,IAAMnD,KAAKsC,wBACjBK,GACJC,EAAA,OACEQ,KAAK,OACLC,MAAM,sBACNC,GAAIzC,EACJkC,IAAMC,IACJhD,KAAK0B,OAASsB,CAAE,GAElBJ,EAAA,c"}