{"version":3,"names":["goDropdownCss","GoDropdown","open","this","disabled","originEl","document","activeElement","isActive","opened","emit","close","focusBackToTrigger","closed","focus","toggle","componentWillLoad","el","id","uniqueId","triggerEl","querySelector","triggerSelector","componentDidLoad","init","escapeHandler","e","code","focusOutHandler","contains","relatedTarget","addEventListener","disconnectedCallback","removeEventListener","clickOutHandler","removeClickOutsideListener","cleanupAutoUpdate","setAttribute","setTriggerExpanded","noTriggerClickHandler","onClickOutside","target","middleware","offset","flip","autoUpdate","debounce","computePosition","strategy","placement","then","x","y","middlewareData","Object","assign","style","left","top","_b","_a","overflows","length","classList","add","remove","expanded","String","handleActiveChange","display","once","render","width","fullWidth","h","Host","class"],"sources":["src/components/go-dropdown/go-dropdown.scss?tag=go-dropdown","src/components/go-dropdown/go-dropdown.tsx"],"sourcesContent":["go-dropdown {\r\n  /**\r\n    @prop --dropdown-shadow:\r\n      Box shadow of dropdown\r\n      - default: var(--shadow-3)\r\n  */\r\n  --dropdown-shadow: var(--shadow-3);\r\n  /**\r\n    @prop --dropdown-bg-color:\r\n      Dropdown background color\r\n      - default: var(--go-color-lightest)\r\n  */\r\n  --dropdown-bg-color: var(--go-color-lightest);\r\n\r\n  /**\r\n    @prop --dropdown-duration:\r\n      Duration for dropdown open/close transition\r\n      - default: var(--go-duration-fast)\r\n  */\r\n  --dropdown-duration: var(--go-duration-fast);\r\n\r\n  /**\r\n    @prop --dropdown-radius:\r\n      Border radius of dropdown\r\n      - default: var(--radius-2)\r\n  */\r\n  --dropdown-radius: var(--radius-2);\r\n\r\n  position: fixed;\r\n  display: none;\r\n  visibility: hidden;\r\n  opacity: 0;\r\n  box-shadow: var(--dropdown-shadow);\r\n  pointer-events: none;\r\n  z-index: 1;\r\n  transform: translateY(-5px);\r\n  transform-origin: top;\r\n  width: var(--dropdown-width, 200px);\r\n  background-color: var(--dropdown-bg-color);\r\n  border-radius: var(--dropdown-radius);\r\n  @include transition(opacity var(--dropdown-duration), visibility, transform var(--dropdown-duration));\r\n  &.full-width {\r\n    --dropdown-width: 100%;\r\n  }\r\n  &.flip {\r\n    transform-origin: bottom;\r\n    transform: translateY(5px);\r\n  }\r\n\r\n  &.is-active {\r\n    visibility: visible;\r\n    opacity: 1;\r\n    pointer-events: inherit;\r\n    transform: translateY(0);\r\n  }\r\n}\r\n","import { Component, Host, h, Element, Prop, Method, Watch, Event, EventEmitter } from '@stencil/core';\r\nimport { uniqueId, debounce } from 'lodash-es';\r\nimport { computePosition, offset, flip, autoUpdate } from '@floating-ui/dom';\r\nimport { onClickOutside, removeClickOutsideListener } from '../../utils';\r\n\r\n@Component({\r\n  tag: 'go-dropdown',\r\n  styleUrl: 'go-dropdown.scss',\r\n  shadow: false,\r\n})\r\nexport class GoDropdown {\r\n  @Element() el: HTMLElement;\r\n  /**\r\n   * Query selector string for the trigger element.\r\n   */\r\n  @Prop() triggerSelector: string;\r\n\r\n  /**\r\n   * keep track of active state\r\n   */\r\n  @Prop({ reflect: true, mutable: true }) isActive: boolean = false;\r\n\r\n  /**\r\n   * Width of the dropdown, any CSS width values can be used.\r\n   */\r\n  @Prop() width? = 'auto';\r\n\r\n  /**\r\n   * If set, trigger click event will need to be handled manually.\r\n   */\r\n  @Prop() noTriggerClickHandler = false;\r\n\r\n  /**\r\n   * If set, dropdown will take full width of its parent.\r\n   */\r\n  @Prop() fullWidth? = false;\r\n\r\n  /**\r\n   * if set, dropdown cannot be opened\r\n   */\r\n  @Prop() disabled? = false;\r\n\r\n  /**\r\n   * Emitted when dropdown is opened\r\n   */\r\n  @Event() opened: EventEmitter<void>;\r\n\r\n  // keep track of where the focus was before the dropdown opens\r\n  originEl: HTMLElement;\r\n\r\n  /**\r\n   * opens dropdown\r\n   */\r\n  @Method()\r\n  async open() {\r\n    if (this.disabled) {\r\n      return;\r\n    }\r\n    this.originEl = document.activeElement as HTMLElement;\r\n    this.isActive = true;\r\n    this.opened.emit();\r\n  }\r\n  /**\r\n   * Emitted when dropdown is opened\r\n   */\r\n  @Event() closed: EventEmitter<void>;\r\n\r\n  /**\r\n   * closes dropdown\r\n   */\r\n  @Method()\r\n  async close(focusBackToTrigger = false) {\r\n    this.isActive = false;\r\n    this.closed.emit();\r\n    if (this.originEl && focusBackToTrigger) {\r\n      this.originEl.focus();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * toggles dropdown\r\n   */\r\n  @Method()\r\n  async toggle() {\r\n    if (this.isActive) {\r\n      this.close();\r\n    } else {\r\n      this.open();\r\n    }\r\n  }\r\n\r\n  private triggerEl: HTMLElement;\r\n\r\n  // reference to clean up function to autoupdate\r\n  // see https://floating-ui.com/docs/autoupdate\r\n  private cleanupAutoUpdate: () => void;\r\n\r\n  componentWillLoad() {\r\n    // if id attribute is not provided, generate a unique id for the dropdown\r\n    if (!this.el.id) {\r\n      this.el.id = uniqueId('go-dropdown-');\r\n    }\r\n    this.triggerEl = document.querySelector(`${this.triggerSelector}`) as HTMLElement;\r\n  }\r\n\r\n  private escapeHandler;\r\n  private focusOutHandler;\r\n  private clickOutHandler;\r\n\r\n  async componentDidLoad() {\r\n    if (!this.triggerEl) {\r\n      return;\r\n    }\r\n    await this.init();\r\n\r\n    // press esc to close dropdown\r\n    this.escapeHandler = (e) => {\r\n      if (e.code === 'Escape') {\r\n        this.close();\r\n      }\r\n    };\r\n    this.focusOutHandler = (e: FocusEvent) => {\r\n      if (this.triggerEl.contains(e.relatedTarget as Node)) {\r\n        return;\r\n      }\r\n      if (e.relatedTarget && !this.el.contains(e.relatedTarget as Node)) {\r\n        this.close();\r\n      }\r\n    };\r\n    document.addEventListener('keydown', this.escapeHandler);\r\n    // focus outside to close dropdown\r\n    this.el.addEventListener('focusout', this.focusOutHandler);\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    if (this.escapeHandler) {\r\n      document.removeEventListener('keydown', this.escapeHandler);\r\n    }\r\n    if (this.focusOutHandler) {\r\n      this.el.removeEventListener('focusout', this.focusOutHandler);\r\n    }\r\n    if (this.clickOutHandler) {\r\n      removeClickOutsideListener(this.clickOutHandler);\r\n    }\r\n    if (this.cleanupAutoUpdate) {\r\n      this.cleanupAutoUpdate();\r\n    }\r\n  }\r\n\r\n  @Method()\r\n  async init() {\r\n    this.triggerEl.setAttribute('aria-haspopup', 'true');\r\n    this.setTriggerExpanded(this.isActive);\r\n\r\n    // add click event listener\r\n    if (!this.noTriggerClickHandler) {\r\n      this.triggerEl.addEventListener('click', () => this.toggle());\r\n    }\r\n\r\n    this.clickOutHandler = onClickOutside(this.el, (e) => {\r\n      if (!this.triggerEl.contains(e.target as Node) && this.isActive) {\r\n        this.close();\r\n      }\r\n    });\r\n    /**\r\n     * Calculate position of dropdown\r\n     */\r\n    const middleware = [offset(4), flip()];\r\n    this.cleanupAutoUpdate = autoUpdate(\r\n      this.triggerEl,\r\n      this.el,\r\n      debounce(() => {\r\n        computePosition(this.triggerEl, this.el, {\r\n          strategy: 'fixed',\r\n          placement: 'bottom-start',\r\n          middleware,\r\n        }).then(({ x, y, middlewareData }) => {\r\n          Object.assign(this.el.style, {\r\n            left: `${x}px`,\r\n            top: `${y}px`,\r\n          });\r\n          if (middlewareData.flip?.overflows?.length > 0) {\r\n            this.el.classList.add('flip');\r\n          } else {\r\n            this.el.classList.remove('flip');\r\n          }\r\n        });\r\n      }, 50),\r\n    );\r\n  }\r\n\r\n  setTriggerExpanded(expanded: boolean) {\r\n    this.triggerEl.setAttribute('aria-expanded', String(expanded));\r\n  }\r\n\r\n  @Watch('isActive')\r\n  handleActiveChange(isActive) {\r\n    this.setTriggerExpanded(isActive);\r\n    if (isActive) {\r\n      this.el.style.display = 'block';\r\n      // focusFirstWithin(this.el);\r\n    } else {\r\n      this.el.addEventListener(\r\n        'transitionend',\r\n        () => {\r\n          this.el.style.display = 'none';\r\n        },\r\n        { once: true },\r\n      );\r\n      this.triggerEl.focus();\r\n    }\r\n  }\r\n\r\n  render() {\r\n    let { isActive, width, fullWidth } = this;\r\n    return (\r\n      <Host\r\n        class={{ 'is-active': isActive, 'full-width': fullWidth }}\r\n        aria-hidden={isActive ? 'false' : 'true'}\r\n        style={{ '--dropdown-width': width }}>\r\n        <div class=\"dropdown-content\">\r\n          <slot></slot>\r\n        </div>\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"],"mappings":"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"}